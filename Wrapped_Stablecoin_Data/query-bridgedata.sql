/* 
Extracted via Flipside Crypto AI Query
Date: 2025-08-11 (Asia/Singapore)
Notes: Generated by AI assistant based on user prompts; manual review performed before execution. Performed on the FlipSide AI website. This can be replicated by using the Snowflake dataset CROSSCHAIN.DEFI.EZ_BRIDGE_ACTIVITY.
*/


WITH bridge_data AS (
  SELECT 
    DATE_TRUNC('minute', block_timestamp) AS datetime,
    LOWER(COALESCE(source_chain, 'unknown')) AS origin_chain,
    LOWER(COALESCE(destination_chain, 'unknown')) AS destination_chain,
    CASE 
      WHEN UPPER(token_symbol) LIKE '%USDC%' THEN 'USDC'
      WHEN UPPER(token_symbol) LIKE '%USDT%' THEN 'USDT' 
      WHEN UPPER(token_symbol) LIKE '%DAI%' THEN 'DAI'
      ELSE UPPER(token_symbol)
    END AS token,
    COALESCE(platform, 'unknown') AS bridge_protocol,
    COALESCE(amount_usd, 0) AS volume_usd,
    1 AS transaction_count
  FROM CROSSCHAIN.DEFI.EZ_BRIDGE_ACTIVITY
  WHERE block_timestamp >= '2020-01-01 00:00:00'
    AND block_timestamp < '2025-08-02 00:00:00'
    AND (
      UPPER(token_symbol) LIKE '%USDC%' OR
      UPPER(token_symbol) LIKE '%USDT%' OR  
      UPPER(token_symbol) LIKE '%DAI%' OR
      UPPER(token_symbol) IN ('USDC', 'USDT', 'DAI', 'USDC.E', 'ANYUSDC', 'ANYUSDT', 'ANYDAI')
    )
)
SELECT 
  TO_CHAR(datetime, 'YYYY-MM-DD HH24:MI:00') AS datetime,
  origin_chain,
  destination_chain, 
  token,
  bridge_protocol,
  SUM(volume_usd) AS volume_usd,
  SUM(transaction_count) AS transaction_count
FROM bridge_data
GROUP BY 
  datetime,
  origin_chain,
  destination_chain,
  token, 
  bridge_protocol
ORDER BY 
  datetime,
  origin_chain,
  destination_chain,
  token,
  bridge_protocol